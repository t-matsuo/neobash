# neobash.sh

Neobashブートストラップファイル。

## 使用方法

### Neobashの読み込み

本ファイルをsourceコマンドで読み込む必要があります。

```bash
source /path/to/lib/neobash.sh
```

本ファイルを読むこむと、自動で全``core``ライブラリがimportされます。

### ライブラリの読み込み

``nb::import``コマンドでライブラリを読み込みます。

(例)
```bash
nb::import 'util/mylib.sh'
```

### ライブラリ読み込み後のbashの挙動

bashの以下の設定が有効になります。

* ``shopt -s expand_aliases``
  * bashのエイリアスが使用可能になります
* ``set -o pipefail``
  * パイプ使用時に、パイプの途中でエラーが発生した場合、最後に失敗したコマンドの戻り値が返ります
* ``set -u``
  * 未定義の変数を使用しようとした場合、エラーメッセージが出力されます
* ``NB_DIR``変数に、neobash.shが置かれているディレクトリの絶対パスが格納されます

## 関数

#### nb::import()

* 概要: ライブラリを読み込みます。
* 引数
  * arg1: ライブラリのパス(文字列)
    * ライブラリ検索パス配下のパスを指定します。
    * (例) neobash提供のライブラリlib/core/log.sh を読み込みたい場合は、``core/log.sh``を指定します
    * ライブラリ検索のパスは後から追加したパスが優先されます。
* 戻り値
  * 0: 成功
* エラー時
  * ライブラリの読み込みに失敗した場合、エラーメッセージを出力しスクリプトを強制終了します
* その他
  * デフォルトでは、neobash.shが置かれているディレクトリのlibディレクトリに配置されているライブラリを読み込みます。
  * nb::add_lib_path()ライブラリ検索パスを追加した場合、そちらのパスが優先して検索され、指定したライブラリが優先パスに存在しない場合、次に優先されるパスが検索されます。
  * neobash提供のcoreディレクトリ配下の全ライブラリはneobash.sh読み込み時に自動で読み込まれるため、明示的にimportする必要はありません。
  * ``*``で指定したディレクトリの全ライブラリをimport可能です。
    * (例) ``nb::import 'util/*'``
  * nb::importされたライブラリは``nb::has_lib()``で調べることが可能です。
  * nb::importされた全ライブラリは``nb::get_libs()``で取得可能です。

#### nb::has_lib()

* 概要: 指定されたライブラリがimportされているか調べます。
* 引数
  * arg1: ライブラリのパス(文字列)
* 戻り値
  * 0: importされています
  * 1: importされていません
* エラー時
  * 引数が未指定の場合、エラーメッセージを出力しスクリプトを強制終了します
* その他
  * なし

#### nb::require()

* 概要: 依存するライブラリを指定します。
* 引数
  * arg1: ライブラリのパス(文字列)
* 戻り値
  * 0: 依存ライブラリはすべてimportされています
* エラー時
  * 依存ライブラリがimportされていない場合、エラーメッセージを出力しスクリプトを強制終了します
* その他
  * なし

#### nb::add_lib_path()
* 概要: ライブラリの検索パスを追加します。
* 引数
  * arg1: 検索場所
* 戻り値
  * 0: 成功
  * 1: 引数が未指定の場合や指定しされたライブラリのパスが存在しない場合
* エラー時
  * エラーメッセージを出力しスクリプトを強制終了します
* その他
  * デフォルトでneobashのlibディレクトリは追加されています。
  * 本関数で追加されたライブラリのパスは、neobash提供のデフォルトのライブラリのパスより優先で検索されます。そのため、neobash提供のライブラリと同名のライブラリが優先パスに存在する場合、neobash提供のライブラリは読み込まれません。ただし、neobash提供のcoreライブラリのみはneobashのブートストラップ時に自動で読み込まれます。

#### nb::get_lib_path()
* 概要: ライブラリの検索パス一覧を取得します。
* 引数
  * なし
* 戻り値
  * 0
* エラー時
  * なし
* その他
  * 一覧を取得した際、先頭に表示されるパスが最も検索の優先度が高いパスとなります。

#### nb::command_check()

* 概要: 依存するコマンドが使用できるかを調べます。
* 引数
  * arg1: 以前するコマンド名
    * スペース区切りで複数のコマンドを指定できます。
* 戻り値
  * 0: 依存コマンドはすべて使用できます
* エラー時
  * 依存コマンドが使用できない場合、エラーメッセージを出力しスクリプトを強制終了します
* その他
  * なし

#### nb::check_bash_min_version()

* 概要: 必要なbashの最低バージョンを調べます。
* 引数
  * arg1: bashのバージョン
    * (例) 4.2.0
* 戻り値
  * 0: bashのバージョンは必要バージョン以上
  * 1: bashのバージョンは必要バージョン未満
* エラー時
  * 指定したbashのバージョンフォーマットが不正な場合、エラーメッセージを出力しスクリプトを強制終了します。
* その他
  * bashのバージョンフォーマットは、xx.yy.zz の形式で指定する必要があります。
